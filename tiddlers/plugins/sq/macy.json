{"tiddlers":{"$:/plugins/sq/macy/default_config.js":{"title":"$:/plugins/sq/macy/default_config.js","type":"application/json","text":"{\n\t\"columns\": 6,\n\t\"trueOrder\": false,\n\t\"margin\": 10,\n\t\"waitForImages\": false,\n\t\"mobileFirst\": false,\n\t\"breakAt\": {\n\t\t\"1300\": 5,\n\t\t\"940\": 3,\n\t\t\"520\": 2,\n\t\t\"400\": 1\t\n\t},\n\t\"useContainerForBreakpoints\": false\n}"},"$:/plugins/sq/macy/icon":{"title":"$:/plugins/sq/macy/icon","type":"text/vnd.tiddlywiki","text":"\n<svg viewBox=\"0 0 149.398 127.648\" height=\"22pt\" width=\"22pt\">\n  <defs>\n    <bx:guide x=\"67.743\" y=\"75.952\" angle=\"90\"/>\n    <bx:guide x=\"58.036\" y=\"78.268\" angle=\"90\"/>\n  </defs>\n  <path fill=\"#52B8CC\" d=\"M 21 48.215 L 9 48.215 C 5.686 48.215 3 45.132 3 41.327 L 3 13.775 C 3 6.168 8.373 0 15 0 L 21 0 C 24.314 0 27 3.083 27 6.888 L 27 41.327 C 27 45.132 24.314 48.215 21 48.215 Z\" style=\"\"/>\n  <path fill=\"#DBDBDB\" d=\"M 51 94.691 L 39 94.691 C 35.686 94.691 33 91.019 33 86.492 L 33 45.497 C 33 40.969 35.686 37.298 39 37.298 L 51 37.298 C 54.314 37.298 57 40.969 57 45.497 L 57 86.492 C 57 91.019 54.314 94.691 51 94.691 Z\" style=\"\"/>\n  <path d=\"M 81 48.215 L 69 48.215 C 65.686 48.215 63 45.132 63 41.327 L 63 6.888 C 63 3.083 65.686 0 69 0 L 81 0 C 84.314 0 87 3.083 87 6.888 L 87 41.327 C 87 45.132 84.314 48.215 81 48.215 Z\" style=\"fill: rgb(219, 219, 219);\"/>\n  <path fill=\"#DBDBDB\" d=\"M 111 85.651 L 99 85.651 C 95.686 85.651 93 82.415 93 78.421 L 93 42.269 C 93 38.276 95.686 35.038 99 35.038 L 111 35.038 C 114.314 35.038 117 38.276 117 42.269 L 117 78.421 C 117 82.415 114.314 85.651 111 85.651 Z\" style=\"\"/>\n  <path fill=\"#52B8CC\" d=\"M 141 45.809 L 129 45.809 C 125.686 45.809 123 42.879 123 39.265 L 123 6.544 C 123 2.93 125.686 0 129 0 L 135 0 C 141.627 0 147 5.86 147 13.088 L 147 39.265 C 147 42.879 144.314 45.809 141 45.809 Z M 21 82.893 L 9 82.893 C 5.686 82.893 3 79.963 3 76.348 L 3 58.897 C 3 55.283 5.686 52.353 9 52.353 L 21 52.353 C 24.314 52.353 27 55.283 27 58.897 L 27 76.348 C 27 79.963 24.314 82.893 21 82.893 Z M 51 30.539 L 39 30.539 C 35.686 30.539 33 27.609 33 23.995 L 33 6.544 C 33 2.93 35.686 0 39 0 L 51 0 C 54.314 0 57 2.93 57 6.544 L 57 23.995 C 57 27.609 54.314 30.539 51 30.539 Z M 81 82.893 L 69 82.893 C 65.686 82.893 63 79.963 63 76.348 L 63 58.897 C 63 55.283 65.686 52.353 69 52.353 L 81 52.353 C 84.314 52.353 87 55.283 87 58.897 L 87 76.348 C 87 79.963 84.314 82.893 81 82.893 Z M 111 30.539 L 99 30.539 C 95.686 30.539 93 27.609 93 23.995 L 93 6.544 C 93 2.93 95.686 0 99 0 L 111 0 C 114.314 0 117 2.93 117 6.544 L 117 23.995 C 117 27.609 114.314 30.539 111 30.539 Z M 141 82.893 L 129 82.893 C 125.686 82.893 123 79.963 123 76.348 L 123 58.897 C 123 55.283 125.686 52.353 129 52.353 L 141 52.353 C 144.314 52.353 147 55.283 147 58.897 L 147 76.348 C 147 79.963 144.314 82.893 141 82.893 Z\" style=\"\"/>\n  <path fill=\"#DBDBDB\" d=\"M 20.597 127.195 L 8.597 127.195 C 5.283 127.195 2.597 124.859 2.597 121.978 L 2.597 95.889 C 2.597 93.009 5.283 90.671 8.597 90.671 L 20.597 90.671 C 23.911 90.671 26.597 93.009 26.597 95.889 L 26.597 121.978 C 26.597 124.859 23.911 127.195 20.597 127.195 Z\" style=\"\"/>\n  <path fill=\"#DBDBDB\" d=\"M 81.244 127.648 L 69.244 127.648 C 65.93 127.648 63.244 125.313 63.244 122.43 L 63.244 96.343 C 63.244 93.461 65.93 91.125 69.244 91.125 L 81.244 91.125 C 84.558 91.125 87.244 93.461 87.244 96.343 L 87.244 122.43 C 87.244 125.313 84.558 127.648 81.244 127.648 Z\" style=\"\"/>\n  <path d=\"M 51 127.195 L 39 127.195 C 35.686 127.195 33 125.305 33 122.972 L 33 101.861 C 33 99.529 35.686 97.639 39 97.639 L 51 97.639 C 54.314 97.639 57 99.529 57 101.861 L 57 122.972 C 57 125.305 54.314 127.195 51 127.195 Z\" style=\"fill: rgb(100, 184, 203);\"/>\n  <path fill=\"#52B8CC\" d=\"M 111 127.648 L 99 127.648 C 95.686 127.648 93 125.222 93 122.229 L 93 95.133 C 93 92.139 95.686 89.714 99 89.714 L 111 89.714 C 114.314 89.714 117 92.139 117 95.133 L 117 122.229 C 117 125.222 114.314 127.648 111 127.648 Z\" style=\"\"/>\n  <path fill=\"#DBDBDB\" d=\"M 141 127.167 L 129 127.167 C 125.686 127.167 123 124.832 123 121.949 L 123 95.862 C 123 92.98 125.686 90.644 129 90.644 L 141 90.644 C 144.314 90.644 147 92.98 147 95.862 L 147 121.949 C 147 124.832 144.314 127.167 141 127.167 Z\" style=\"\"/>\n</svg>"},"$:/plugins/sq/macy/macy.js":{"title":"$:/plugins/sq/macy/macy.js","text":"!function(t,n){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=n():\"function\"==typeof define&&define.amd?define(n):t.Macy=n()}(this,function(){\"use strict\";function t(t,n){var e=void 0;return function(){e&&clearTimeout(e),e=setTimeout(t,n)}}function n(t,n){for(var e=t.length,r=e,o=[];e--;)o.push(n(t[r-e-1]));return o}function e(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(window.Promise)return A(t,n,e);t.recalculate(!0,!0)}function r(t){for(var n=t.options,e=t.responsiveOptions,r=t.keys,o=t.docWidth,i=void 0,s=0;s<r.length;s++){var a=parseInt(r[s],10);o>=a&&(i=n.breakAt[a],O(i,e))}return e}function o(t){for(var n=t.options,e=t.responsiveOptions,r=t.keys,o=t.docWidth,i=void 0,s=r.length-1;s>=0;s--){var a=parseInt(r[s],10);o<=a&&(i=n.breakAt[a],O(i,e))}return e}function i(t){var n=t.useContainerForBreakpoints?t.container.clientWidth:window.innerWidth,e={columns:t.columns};b(t.margin)?e.margin={x:t.margin.x,y:t.margin.y}:e.margin={x:t.margin,y:t.margin};var i=Object.keys(t.breakAt);return t.mobileFirst?r({options:t,responsiveOptions:e,keys:i,docWidth:n}):o({options:t,responsiveOptions:e,keys:i,docWidth:n})}function s(t){return i(t).columns}function a(t){return i(t).margin}function c(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=s(t),r=a(t).x,o=100/e;if(!n)return o;if(1===e)return\"100%\";var i=\"px\";if(\"string\"==typeof r){var c=parseFloat(r);i=r.replace(c,\"\"),r=c}return r=(e-1)*r/e,\"%\"===i?o-r+\"%\":\"calc(\"+o+\"% - \"+r+i+\")\"}function u(t,n){var e=s(t.options),r=0,o=void 0,i=void 0;if(1===++n)return 0;i=a(t.options).x;var u=\"px\";if(\"string\"==typeof i){var l=parseFloat(i,10);u=i.replace(l,\"\"),i=l}return o=(i-(e-1)*i/e)*(n-1),r+=c(t.options,!1)*(n-1),\"%\"===u?r+o+\"%\":\"calc(\"+r+\"% + \"+o+u+\")\"}function l(t){var n=0,e=t.container,r=t.rows;v(r,function(t){n=t>n?t:n}),e.style.height=n+\"px\"}function p(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=s(t.options),i=a(t.options).y;M(t,o,e),v(n,function(n){var e=0,o=parseInt(n.offsetHeight,10);isNaN(o)||(t.rows.forEach(function(n,r){n<t.rows[e]&&(e=r)}),n.style.position=\"absolute\",n.style.top=t.rows[e]+\"px\",n.style.left=\"\"+t.cols[e],t.rows[e]+=isNaN(o)?0:o+i,r&&(n.dataset.macyComplete=1))}),r&&(t.tmpRows=null),l(t)}function f(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=s(t.options),i=a(t.options).y;M(t,o,e),v(n,function(n){t.lastcol===o&&(t.lastcol=0);var e=C(n,\"height\");e=parseInt(n.offsetHeight,10),isNaN(e)||(n.style.position=\"absolute\",n.style.top=t.rows[t.lastcol]+\"px\",n.style.left=\"\"+t.cols[t.lastcol],t.rows[t.lastcol]+=isNaN(e)?0:e+i,t.lastcol+=1,r&&(n.dataset.macyComplete=1))}),r&&(t.tmpRows=null),l(t)}var h=function t(n,e){if(!(this instanceof t))return new t(n,e);if(n&&n.nodeName)return n;if(n=n.replace(/^\\s*/,\"\").replace(/\\s*$/,\"\"),e)return this.byCss(n,e);for(var r in this.selectors)if(e=r.split(\"/\"),new RegExp(e[1],e[2]).test(n))return this.selectors[r](n);return this.byCss(n)};h.prototype.byCss=function(t,n){return(n||document).querySelectorAll(t)},h.prototype.selectors={},h.prototype.selectors[/^\\.[\\w\\-]+$/]=function(t){return document.getElementsByClassName(t.substring(1))},h.prototype.selectors[/^\\w+$/]=function(t){return document.getElementsByTagName(t)},h.prototype.selectors[/^\\#[\\w\\-]+$/]=function(t){return document.getElementById(t.substring(1))};var v=function(t,n){for(var e=t.length,r=e;e--;)n(t[r-e-1])},m=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.running=!1,this.events=[],this.add(t)};m.prototype.run=function(){if(!this.running&&this.events.length>0){var t=this.events.shift();this.running=!0,t(),this.running=!1,this.run()}},m.prototype.add=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!!n&&(Array.isArray(n)?v(n,function(n){return t.add(n)}):(this.events.push(n),void this.run()))},m.prototype.clear=function(){this.events=[]};var d=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.instance=t,this.data=n,this},y=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.events={},this.instance=t};y.prototype.on=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!(!t||!n)&&(Array.isArray(this.events[t])||(this.events[t]=[]),this.events[t].push(n))},y.prototype.emit=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t||!Array.isArray(this.events[t]))return!1;var e=new d(this.instance,n);v(this.events[t],function(t){return t(e)})};var g=function(t){return!(\"naturalHeight\"in t&&t.naturalHeight+t.naturalWidth===0)||t.width+t.height!==0},E=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise(function(t,e){if(n.complete)return g(n)?t(n):e(n);n.addEventListener(\"load\",function(){return g(n)?t(n):e(n)}),n.addEventListener(\"error\",function(){return e(n)})}).then(function(n){e&&t.emit(t.constants.EVENT_IMAGE_LOAD,{img:n})}).catch(function(n){return t.emit(t.constants.EVENT_IMAGE_ERROR,{img:n})})},w=function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n(e,function(n){return E(t,n,r)})},A=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Promise.all(w(t,n,e)).then(function(){t.emit(t.constants.EVENT_IMAGE_COMPLETE)})},I=function(n){return t(function(){n.emit(n.constants.EVENT_RESIZE),n.queue.add(function(){return n.recalculate(!0,!0)})},100)},N=function(t){if(t.container=h(t.options.container),t.container instanceof h||!t.container)return!!t.options.debug&&console.error(\"Error: Container not found\");t.container.length&&(t.container=t.container[0]),t.options.container=t.container,t.container.style.position=\"relative\"},T=function(t){t.queue=new m,t.events=new y(t),t.rows=[],t.resizer=I(t)},L=function(t){var n=h(\"img\",t.container);t.on(t.constants.EVENT_IMAGE_LOAD,function(){return t.recalculate(!1,!1)}),t.on(t.constants.EVENT_IMAGE_COMPLETE,function(){return t.recalculate(!0,!0)}),t.options.useOwnImageLoader||e(t,n,!t.options.waitForImages),t.emit(t.constants.EVENT_INITIALIZED)},_=function(t){N(t),T(t),L(t)},b=function(t){return t===Object(t)&&\"[object Array]\"!==Object.prototype.toString.call(t)},O=function(t,n){b(t)||(n.columns=t),b(t)&&t.columns&&(n.columns=t.columns),b(t)&&t.margin&&!b(t.margin)&&(n.margin={x:t.margin,y:t.margin}),b(t)&&t.margin&&b(t.margin)&&t.margin.x&&(n.margin.x=t.margin.x),b(t)&&t.margin&&b(t.margin)&&t.margin.y&&(n.margin.y=t.margin.y)},C=function(t,n){return window.getComputedStyle(t,null).getPropertyValue(n)},M=function(t,n){var e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.lastcol||(t.lastcol=0),t.rows.length<1&&(e=!0),e){t.rows=[],t.cols=[],t.lastcol=0;for(var r=n-1;r>=0;r--)t.rows[r]=0,t.cols[r]=u(t,r)}else if(t.tmpRows){t.rows=[];for(var r=n-1;r>=0;r--)t.rows[r]=t.tmpRows[r]}else{t.tmpRows=[];for(var r=n-1;r>=0;r--)t.tmpRows[r]=t.rows[r]}},V=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n?t.container.children:h(':scope > *:not([data-macy-complete=\"1\"])',t.container);r=Array.from(r).filter(function(t){return null!==t.offsetParent});var o=c(t.options);return v(r,function(t){n&&(t.dataset.macyComplete=0),t.style.width=o}),t.options.trueOrder?(f(t,r,n,e),t.emit(t.constants.EVENT_RECALCULATED)):(p(t,r,n,e),t.emit(t.constants.EVENT_RECALCULATED))},R=function(){return!!window.Promise},x=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};Array.from||(Array.from=function(t){for(var n=0,e=[];n<t.length;)e.push(t[n++]);return e});var k={columns:4,margin:2,trueOrder:!1,waitForImages:!1,useImageLoader:!0,breakAt:{},useOwnImageLoader:!1,onInit:!1,cancelLegacy:!1,useContainerForBreakpoints:!1};!function(){try{document.createElement(\"a\").querySelector(\":scope *\")}catch(t){!function(){function t(t){return function(e){if(e&&n.test(e)){var r=this.getAttribute(\"id\");r||(this.id=\"q\"+Math.floor(9e6*Math.random())+1e6),arguments[0]=e.replace(n,\"#\"+this.id);var o=t.apply(this,arguments);return null===r?this.removeAttribute(\"id\"):r||(this.id=r),o}return t.apply(this,arguments)}}var n=/:scope\\b/gi,e=t(Element.prototype.querySelector);Element.prototype.querySelector=function(t){return e.apply(this,arguments)};var r=t(Element.prototype.querySelectorAll);Element.prototype.querySelectorAll=function(t){return r.apply(this,arguments)}}()}}();var q=function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k;if(!(this instanceof t))return new t(n);this.options={},x(this.options,k,n),this.options.cancelLegacy&&!R()||_(this)};return q.init=function(t){return console.warn(\"Depreciated: Macy.init will be removed in v3.0.0 opt to use Macy directly like so Macy({ /*options here*/ }) \"),new q(t)},q.prototype.recalculateOnImageLoad=function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e(this,h(\"img\",this.container),!t)},q.prototype.runOnImageLoad=function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=h(\"img\",this.container);return this.on(this.constants.EVENT_IMAGE_COMPLETE,t),n&&this.on(this.constants.EVENT_IMAGE_LOAD,t),e(this,r,n)},q.prototype.recalculate=function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e&&this.queue.clear(),this.queue.add(function(){return V(t,n,e)})},q.prototype.remove=function(){window.removeEventListener(\"resize\",this.resizer),v(this.container.children,function(t){t.removeAttribute(\"data-macy-complete\"),t.removeAttribute(\"style\")}),this.container.removeAttribute(\"style\")},q.prototype.reInit=function(){this.recalculate(!0,!0),this.emit(this.constants.EVENT_INITIALIZED),this.container.style.position=\"relative\"},q.prototype.on=function(t,n){this.events.on(t,n)},q.prototype.emit=function(t,n){this.events.emit(t,n)},q.constants={EVENT_INITIALIZED:\"macy.initialized\",EVENT_RECALCULATED:\"macy.recalculated\",EVENT_IMAGE_LOAD:\"macy.image.load\",EVENT_IMAGE_ERROR:\"macy.image.error\",EVENT_IMAGE_COMPLETE:\"macy.images.complete\",EVENT_RESIZE:\"macy.resize\"},q.prototype.constants=q.constants,q});\n","type":"application/javascript","module-type":"library"},"$:/plugins/sq/macy/readme":{"title":"$:/plugins/sq/macy/readme","text":"@@color:red;''Experimental plugin - no support available. Use at your own risk.''@@\n\nMasonry layout plugin for images based on the [[Macy library|https://github.com/bigbite/macy.js]]. Licensed under the [[MIT License|https://github.com/bigbite/macy.js/blob/master/LICENSE]]."},"$:/plugins/sq/macy/styles":{"title":"$:/plugins/sq/macy/styles","tags":"$:/tags/Stylesheet","type":"text/css","text":".macy-container::before {\n\tcontent: \"\";\n\tdisplay: table;\n\tclear: both\n}\n\n.macy-container {\n\tmargin-top: 22px\n}\n\n.macy-container::after {\n\tcontent: \"\";\n\tdisplay: table;\n\tclear: both\n}\n\n.macy-container .item-container {\n\tmargin-bottom: 24px;\n\tborder-radius: 4px;\n\toverflow: hidden;\n\tborder: 1px solid #eee\n}\n\n.macy-container .item {\n\twidth: 100%;\n\tdisplay: block;\n\theight: auto\n}\n\n.macy-container > .item-container {\n\topacity: 0.5;\n\t/*transition: all 0.5s ease;*/\n\t/** make this a config setting **/\n}\n\n.macy-container.macy-ready > .item-container {\n\topacity: 1;\n\ttransition: all 0.2s ease;\n}\n\n/**\n.macy-container > .item-container {\n    opacity: 0;\n}\n\n.macy-container > div[data-macy-complete=\"1\"] {\n    opacity: 1;\n    transform: translateY(0);\n    transition: top .2s ease-in-out,left .2s ease-in-out,opacity .2s ease-in-out,transform .2s ease-in-out opacity 0.2s width 0.2;\n}\n**/"},"$:/plugins/sq/macy/widget.js":{"title":"$:/plugins/sq/macy/widget.js","text":"/*\\\ntitle: $:/plugins/sq/macy/widget.js\ntype: application/javascript\nmodule-type: widget\n\n\\*/\n(function(){\n\n/*jslint node: true, browser: true */\n/*global $tw: false */\n\"use strict\";\nexports.platforms = [\"browser\"];\nif(!$tw.sq) {\n\t$tw.sq = {};\n}\n\n/*\n * by rpemberton: https://gist.github.com/rpemberton/b15a206f453ff233830f3183e4ac371a\n*/\nfunction debounce(fn) {\n  let raf;\n\n  return (...args) => {\n\tif (raf) {\n\t  //console.log('debounced');\n\t  return;\n\t}\n\n\traf = window.requestAnimationFrame(() => {\n\t  fn(...args); // run useful code\n\t  raf = undefined;\n\t});\n  };\n}\n\n/*\n * prefix: the prefix to check in the attribute name, use an empty string for no prefix\n * match: true if the prefix needs to be present, false if it should not be present\n * exclude: array of attribute names to exclude\n */\nfunction getConfigFromAttributes(attributes,prefix,match,exclude) {\n    var config = {};\n\texclude = exclude || [];\n    $tw.utils.each(attributes,function(attribute,name) {\n\t// node.classList[state ? \"add\" : \"remove\"](class_name);\n    \tif( ((match && name.startsWith(prefix)) || (!match && !name.startsWith(prefix))) && !exclude.includes(name) ) {\n            //check if we have a boolean represented as a string\n            var attr = (attribute === \"true\") ? true : ((attribute === \"false\") ? false : attribute);\n            //check if we have a number represented as a string\n            if(!isNaN(parseFloat(attribute))) {\n                attr = parseFloat(attr);\n            }\n    \t\tconfig[name] = attr;\n    \t}\n    });\n\treturn config;\n}\n\nvar Widget = require(\"$:/core/modules/widgets/widget.js\").widget;\n\n\nvar MacyWidget = function(parseTreeNode,options) {\n\tthis.initialise(parseTreeNode,options);\n};\n\n/*\nInherit from the base widget class\n*/\nMacyWidget.prototype = new Widget();\n\n/*\nRender this widget into the DOM\n*/\nMacyWidget.prototype.render = function(parent,nextSibling) {\n\tvar self = this;\n\tthis.parentDomNode = parent;\n\tthis.computeAttributes();\n\tthis.execute();\t\n\tthis.domNode = this.document.createElement(\"div\");\n\tthis.domNode.className = \"macy-container\";\n\tthis.domNode.style.position = \"relative\";\n\tparent.insertBefore(this.domNode,nextSibling);\n\tthis.renderChildren(this.domNode,null);\n\tthis.domNodes.push(this.domNode);\n/*\n\t$tw.sq.data = new Map();\n\t$tw.sq.data[this.domNode] = this;\n\tconsole.log($tw.sq.data[this.domNode]);\n*/\n\tif(!$tw.sq.Macy) {\n\t\t$tw.sq.Macy = require(\"$:/plugins/sq/macy/macy.js\");\n\t}\n\tthis.macy = new $tw.sq.Macy($tw.utils.extend(this.macyConfig,{\"container\":this.domNode}));\n\t// add event listener on root widget and re-use?\n\t\t// https://stackoverflow.com/questions/66109481/how-to-utilize-resizeobserver-for-multiple-behaviors\n\t\t// https://stackoverflow.com/questions/51528940/resizeobserver-one-vs-multiple-performance\n\tthis.macy.on(this.macy.constants.EVENT_IMAGE_COMPLETE, function (ctx) {\n\t\tself.attachResizeObserver(self.domNode,100,true,true,function(){self.macy.recalculate(true,true)});\n\t\t\n\t});\n\tthis.macy.on(this.macy.constants.EVENT_IMAGE_COMPLETE,function(ctx) {\n\t\t$tw.utils.addClass(self.domNode,\"macy-ready\");\n\t});\n};\n\n/*\n * node\t\t\t\tHTML Element to observe\n * delay\t\t\ttimeout parameter\n * observeWidth\t\tboolean to indicate whether a change in width should trigger the callback\n * observeHeight\tboolean to indicate whether a change in height should trigger the callback\n * callback\t\t\tfunction to call when size has changed\n */\nMacyWidget.prototype.attachResizeObserver = function(node,delay,observeWidth,observeHeight,callback) {\n\tvar self = this;\n\tif(!this.win) {\n\t\tthis.win = self.document.parentWindow || self.document.defaultView;\n\t}\n\tif(!this.state) {\n\t\tthis.state = Object.create(null);\n\t}\n\tthis.state.resizeObserver = Object.create(null);\n\tself.resizeObserver = new self.win.ResizeObserver(entries => {\n\t\tfor(let entry of entries) {\n\t\t\t// wrap in requestAnimationFrame to avoid observer loop limit error\n\t\t\t// https://stackoverflow.com/questions/49384120/resizeobserver-loop-limit-exceeded\n\t\t\t// https://blog.elantha.com/resizeobserver-loop-limit-exceeded/\n\t\t\tdebounce(function() {\n\t\t\t\tif (!Array.isArray(entries) || !entries.length) {\n\t\t\t\t\t  return;\n\t\t\t\t\t}\n\t\t\t\tif((observeHeight && (parseInt(entry.contentBoxSize[0][\"blockSize\"]) !== self.state.resizeObserver.height)) || (observeWidth && (parseInt(entry.contentBoxSize[0][\"inlineSize\"]) !== self.state.resizeObserver.width))) {\n\t\t\t\t\tself.resizeObserver.unobserve(node);\n\t\t\t\t\tself.state.resizeObserver.height = entry.contentBoxSize[0][\"blockSize\"];\n\t\t\t\t\tself.state.resizeObserver.width = entry.contentBoxSize[0][\"inlineSize\"];\n\n\t\t\t\t\tself.win.clearTimeout(self.state.resizeObserver.resizeTimeoutId);\n\t\t\t\t\tself.state.resizeObserver.resizeTimeoutId = self.win.setTimeout(function(){\n\t\t\t\t\t\t//self.swiper.updateSize();\n\t\t\t\t\t\tcallback.call();\n\t\t\t\t\t\tself.win.requestAnimationFrame(() => {\n\t\t\t\t\t\t\tself.resizeObserver.observe(node);\n\t\t\t\t\t\t})\n\t\t\t\t\t}, delay);\n\t\t\t\t}\n\t\t\t})();\n\t\t}\t\t\n\t});\n\tself.resizeObserver.observe(node);\n};\n\nMacyWidget.prototype.execute = function() {\n\tvar configText = this.wiki.getTiddlerText(\"$:/plugins/sq/macy/default_config.js\",\"{}\"),\n\t\tdefaultConfig = $tw.utils.parseJSONSafe(this.wiki.getTiddlerText(\"$:/plugins/sq/macy/default_config.js\",\"{}\")),\n\t\tconfig = getConfigFromAttributes(this.attributes,\"$\",false,[\"breakAt\"]),\n\t\tbreakAtString = this.getAttribute(\"breakAt\");\n\t\n\tif(breakAtString) {\n\t\tconfig.breakAt = Object.create(null);\n\t\tvar breakPoints = breakAtString.trim().split(/\\s+/);\n\t\tbreakPoints.forEach((item) => {\n\t\t\tvar params = item.split(\":\").map((item) => parseInt(item));\n\t\t\tif(params.length < 2) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconfig.breakAt[params[0]] = {\n\t\t\t\tcolumns: params[1]\n\t\t\t};\n\t\t\tif(params[2] && params[3]) {\n\t\t\t\tconfig.breakAt[params[0]].margin = {\n\t\t\t\t\tx: params[2],\n\t\t\t\t\ty: params[3]\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t}\n\tthis.macyConfig = $tw.utils.extend(defaultConfig,config);\n\tthis.makeChildWidgets();\n};\n\nMacyWidget.prototype.refresh = function(changedTiddlers) {\n\tvar changedAttributes = this.computeAttributes();\n\tif($tw.utils.count(changedAttributes)>0) {\n\t\tthis.macy.remove();\n\t\tthis.refreshSelf();\n\t\treturn true;\n\t} else {\n\t\tvar retValue = this.refreshChildren(changedTiddlers);\n\t\tif(retValue) {\n\t\t\tthis.macy.recalculate(true,true);\n\t\t} \n\t\treturn retValue;\n\t}\n};\n\nexports[\"macy\"] = MacyWidget;\n\n})();\n","type":"application/javascript","module-type":"widget"}}}